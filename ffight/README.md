# Final Fight

![Andore at start](https://github.com/user-attachments/assets/62648f7e-de08-4460-a915-520712c65192)

## System information

**CPU**
* Motorola MC68000 10 MHz
* Zilog Z80 3.5 MHz

**Specs**<br>
[M68000](../specs/M68000_16_32-Bit_Microprocessor_Programmers_Reference_Manual_4th_Edition_text.pdf)

## General game data

$FF8412 = scenario position

## Character's management

### Player data

Player data is stored on the following addresses:

```
$FF8569 - Player 1
$FF8629 - Player 2
```

Starting from these offset, I found the following information stored for each player:

```
O = offset
O + 05 = pos x (word)
O + 0A = pos y (byte)
O + 13 = character (byte, from 0 to 2)
0 + 25 = animation frame
...
```

### Enemy data

Typically, when an enemy dies the address slot reserved for it get free so when the next enemy spawn on the screen can take it.
This is a bit of content map that an enemy slot can contains:

```
O = offset
O + $06	pos x
O + $07	pos x
O + $12	character
O + $13	character
O + $14	character
O + $15	initial pose
O + $18	energy		
O + $1C	energy bar size
O + $25 frame animation object (double)
...
```

### Characters

This is the character's available value that I discovered so far:

```
byte position:
12|13|14

02 00 00 = bred
02 00 01 = doug
02 00 02 = jake
02 00 03 = simons
02 01 00 = j
02 01 01 = two.p
02 02 00 = axl
02 02 01 = slash
02 03 00 = andore jr.
02 03 01 = andore
02 03 02 = g.andore
02 04 00 = g. oriber
02 04 01 = bill bull
02 04 02 = wong who
02 05 00 = holly wood
02 05 01 = el gado
02 06 00 = roxy
02 06 01 = poison
02 08 00 = holly wood (red)
```

### Initial pose

Below are some codes I found for the character's initial pose.
<br/>
Behaviour may vary according to the character kind itself, so for instance a value of 0x04 means staying crouched for Bred, while for Andore it means immediately charging the player

```
00 = ?
01 = ?
02 = lean against the wall
04 = ?
06 = ?
07 = coming from a door
0C = coming from above
```

### Special scenes

#### Intro


| ROM    | VALUE | CHARACTER | MEMORY  |
| ------ | ----- | --------- | ------- |
| $6EC91 | $2100 | Damnd     | $ffade9 |
| $6EC9F | $2101 | Doug      | $ffad29 |
| $6ECAD | $2102 | Jake      | $ffac69 |



All the above characters are generated by Routine B (see Enemy's spawn code chapter)

#### Bonus: Car

```
$ffaea8 = offset = O
O + 07  = pos x
O + 0B  = pos y
O + 13  = character
```

### Enemy's spawn code

Everytime an enemy spawn in the fight, a free ram **slot** of $C0 bytes is booked for managing enemy's data, such as animation, position, etc.

Here's an example of slot's map address:

```
1. $ff8fe8
2. $ff8f28
3. $ff8e68
4. $ff8da8
5. $ff8ce8
[...]

Boss:
$ff9a68
```

There are some routines responsable for the enemy spawning during gameplay.

There are some I found by playing on Slum and Subway stages (first 2 levels):

```
[Routine A]
 01FAF2  move.b  #$1, ($0,A4)                                197C 0001 0000
 01FAF8  move.b  #$0, ($13,A4)                               197C 0000 0013
 01FAFE  move.w  ($0,A2), ($6,A4)                            396A 0000 0006
 01FB04  move.w  ($2,A2), ($a,A4)                            396A 0002 000A
 01FB0A  move.b  ($0,A0), ($36,A4)                           1968 0000 0036
 01FB10  move.b  ($1,A0), ($14,A4)                           1968 0001 0014
 01FB16  move.b  ($2,A0), ($60,A4)                           1968 0002 0060
 01FB1C  bpl     $1fb24                                      6A06
 01FB1E  move.b  ($a9,A5), ($60,A4)                          196D 00A9 0060
 01FB24  move.b  #$7, ($15,A4)                               197C 0007 0015
 01FB2A  lea     ($3,A0), A0                                 41E8 0003
 01FB2E  dbra    D3, $1fae4                                  51CB FFB4
 01FB32  rts                                                 4E75

[Routine B]
 00620C  sub.w   D0, ($a,A4)                                 916C 000A
 006210  move.b  ($7,A3), ($13,A4)                           196B 0007 0013
 006216  move.w  ($8,A3), ($14,A4)                           396B 0008 0014
 00621C  move.b  ($a,A3), ($36,A4)                           196B 000A 0036
 006222  move.b  ($b,A3), ($62,A4)                           196B 000B 0062
 006228  move.b  ($c,A3), ($60,A4)                           196B 000C 0060
 00622E  bpl     $6238                                       6A00 0008
 006232  move.b  ($a9,A5), ($60,A4)                          196D 00A9 0060
 006238  rts                                                 4E75
 00623A  bsr     $62c8                                       6100 008C
 00623E  bne     $6248                                       6608
 006240  jsr     $38d0.w                                     4EB8 38D0
 006244  beq     $61ba                                       6700 FF74
 006248  rts                                                 4E75

[Routine C] 
 005EE0  add.w   D0, D2                                      D440
 005EE2  move.w  D2, ($a,A4)                                 3942 000A
 005EE6  move.l  ($8,A3), ($12,A4)                           296B 0008 0012
 005EEC  move.b  ($c,A3), ($36,A4)                           196B 000C 0036
 005EF2  move.b  ($d,A3), ($62,A4)                           196B 000D 0062
 005EF8  move.b  ($e,A3), ($60,A4)                           196B 000E 0060
 005EFE  bpl     $5f06                                       6A06
 005F00  move.b  ($a9,A5), ($60,A4)                          196D 00A9 0060
 005F06  rts                                                 4E75
 005F08  tst.b   ($f,A3)                                     4A2B 000F
 005F0C  beq     $5f18                                       670A
 005F0E  move.b  ($568,A5), D0                               102D 0568
 005F12  and.b   ($628,A5), D0                               C02D 0628
 005F16  beq     $5f1c                                       6704
 
[Routine D]
 053714  move.b  #$1, ($0,A4)                                197C 0001 0000
 05371A  move.b  #$0, ($13,A4)                               197C 0000 0013
 053720  move.b  ($62,A6), ($14,A4)                          196E 0062 0014
 053726  move.b  #$9, ($15,A4)                               197C 0009 0015
 05372C  move.b  ($36,A6), ($36,A4)                          196E 0036 0036
 053732  move.w  ($6,A6), D0                                 302E 0006
 053736  addi.w  #$80, D0                                    0640 0080
 05373A  move.w  D0, ($6,A4)                                 3940 0006
 05373E  move.w  ($a,A6), D0                                 302E 000A
 053742  subi.w  #$6, D0                                     0440 0006
 053746  move.w  D0, ($a,A4)                                 3940 000A
 05374A  move.w  A6, ($a8,A4)                                394E 00A8
 05374E  move.w  A4, ($a8,A6)                                3D4C 00A8
```

This is the enemy map of the slum level:

```
[Slum 1]
06d033	000002	-> routine b
01fb45	000007	-> routine a
01fb48	000107	-> routine a
01fb4b	000207	-> routine a
06d05e	010002	-> routine b
06d06b	010000	-> routine b
06d02c	0000
01fb4f	000007	-> routine a
01fb52	000107	-> routine a
01fb55	000207	-> routine a
0705ac	02000100	-> routine c
0705bc	02000000	-> routine c
0705cc	02050000	-> routine c
0705dc	02020000	-> routine c
[Slum 2]
06d0df	000204	-> routine b	
06d0ed	020001	-> routine b	
06d109	000006	-> routine b	
070610	02040006	-> routine c
070620	02040100	-> routine c
[Slum 3]
06D153	010002	-> routine b
06D161	020002	-> routine b
06D16F	010102	-> routine b
070666	02050000	-> routine c
070676	02000000	-> routine c
070686	02000100	-> routine c
070686	02010000	-> routine c

0706b8	02040000	-> routine c
0706c8	02060004	-> routine c
0706d8	02000000	-> routine c
0706e8	02000100	-> routine c
0706f8	02080000	-> routine c

[Subway 1]
06D189	060002	-> routine b
06d197	060106	-> routine b
06d1a5	020000	-> routine b
06D1B3	020100	-> routine b
070734	02050000	-> routine c
070744	02000000	-> routine c
070754	02010100	-> routine c
070764	02030000	-> routine c
[Subway 2]
06D1FD	010001	-> routine b
06D20B	010101	-> routine b
06d219	000201	-> routine b
06d227	000301	-> routine b
06d243	030004	-> routine b
06d251	060006	-> routine b
06d25F	050000	-> routine b
06d26D	020002	-> routine b
06d289	000001	-> routine b
06d297	000101	-> routine b
06d2A5	000000	-> routine b
06d2b3	000100	-> routine b
06d2c1	000100	-> routine b
06d2CF	000000	-> routine b
0707a8	02030004	-> routine c
0707b8	02060000	-> routine c
0707c8	02050000	-> routine c
06d307	010101	-> routine b
06D315	010001	-> routine b
06D331	020000	-> routine b
070808	02050000	-> routine c
070818	02030000	-> routine c
070828	02050100	-> routine c
070838	02040000	-> routine c
[Subway 3]
06d3A5	020001	-> routine b
06d3B3	010002	-> routine b
06d3c1	000206	-> routine b
ffbdca	00	-> routine d
ffbd0a	01	-> routine d
ffbc4a	02	-> routine d
07087c	02000000	-> routine c
07088c	02080000	-> routine c
07089c	02000300	-> routine c
0708ac	02080000	-> routine c
0708bc	02000100	-> routine c
0708cc	02080000	-> routine c
0708dc	02050000	-> routine c
```

### Bosses

```
04 0000 = Damnd
04 0100 = Sodom
04 0200 = Edi.E
04 0300 = Rolento
04 0400 = Abigail
04 0500 = Belger
04 0600 = Bosstest
```
